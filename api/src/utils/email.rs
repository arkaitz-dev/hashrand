use anyhow::{Result, anyhow};
use serde_json::json;
use spin_sdk::{
    http::{Method, Request, Response},
    variables,
};

/// Email configuration loaded from Spin variables
#[derive(Debug)]
pub struct EmailConfig {
    pub api_url: String,
    pub api_token: String,
    pub inbox_id: String,
    pub from_email: String,
}

impl EmailConfig {
    /// Load email configuration from Spin environment variables
    pub fn from_environment() -> Result<Self> {
        let api_url = variables::get("mailtrap_api_url")
            .map_err(|e| anyhow!("Missing mailtrap_api_url: {}", e))?;
        let api_token = variables::get("mailtrap_api_token")
            .map_err(|e| anyhow!("Missing mailtrap_api_token: {}", e))?;
        let inbox_id = variables::get("mailtrap_inbox_id")
            .map_err(|e| anyhow!("Missing mailtrap_inbox_id: {}", e))?;
        let from_email =
            variables::get("from_email").map_err(|e| anyhow!("Missing from_email: {}", e))?;

        Ok(EmailConfig {
            api_url,
            api_token,
            inbox_id,
            from_email,
        })
    }
}

/// Creates an HTTP request for sending email via Mailtrap API
fn create_email_request(
    config: &EmailConfig,
    recipient_email: &str,
    magic_link: &str,
    language: Option<&str>,
) -> Result<Request> {
    // Create email payload according to Mailtrap API format
    let email_payload = json!({
        "from": {
            "email": config.from_email,
            "name": "HashRand"
        },
        "to": [
            {
                "email": recipient_email,
                "name": recipient_email.split('@').next().unwrap_or("User")
            }
        ],
        "subject": create_subject(language),
        "text": create_magic_link_text(magic_link, language),
        "html": create_magic_link_html(magic_link, language),
        "category": "Authentication"
    });

    // Convert payload to JSON string
    let body_json = serde_json::to_string(&email_payload)
        .map_err(|e| anyhow!("Failed to serialize email payload: {}", e))?;

    // Build full URL with inbox ID (format: https://sandbox.api.mailtrap.io/api/send/INBOX_ID)
    let full_url = format!("{}/{}", config.api_url, config.inbox_id);

    // Build HTTP request using Spin's Request builder
    let request = Request::builder()
        .method(Method::Post)
        .uri(&full_url)
        .header("Content-Type", "application/json")
        .header("Authorization", format!("Bearer {}", config.api_token))
        .body(body_json)
        .build();

    Ok(request)
}

/// Sends a magic link email to the specified recipient using Mailtrap REST API
///
/// # Arguments
/// * `recipient_email` - The email address to send the magic link to
/// * `magic_link` - The full magic link URL for authentication
/// * `language` - Optional language code for email template (e.g., "es", "en")
///
/// # Returns
/// * `Ok(())` if the email was sent successfully
/// * `Err(anyhow::Error)` if there was an error sending the email
pub async fn send_magic_link_email(
    recipient_email: &str,
    magic_link: &str,
    language: Option<&str>,
) -> Result<()> {
    let config = EmailConfig::from_environment()?;

    // Validate email format (basic validation)
    if recipient_email.is_empty() || !recipient_email.contains('@') {
        return Err(anyhow!(
            "Invalid recipient email address: {}",
            recipient_email
        ));
    }

    // Create HTTP request for Mailtrap API
    let request = create_email_request(&config, recipient_email, magic_link, language)?;

    // Send HTTP request using Spin's outbound HTTP
    let response: Response = spin_sdk::http::send(request)
        .await
        .map_err(|e| anyhow!("Failed to send HTTP request to Mailtrap API: {}", e))?;

    // Check if the request was successful
    let status = response.status();
    if *status == 200 || *status == 202 {
        println!(
            "‚úÖ Magic link email sent successfully to: {} (Status: {})",
            recipient_email, status
        );
        Ok(())
    } else {
        let body = String::from_utf8_lossy(response.body());
        Err(anyhow!(
            "Mailtrap API returned error. Status: {}, Body: {}",
            status,
            body
        ))
    }
}

/// Creates the subject line based on language
fn create_subject(language: Option<&str>) -> &'static str {
    match language {
        Some("es") => "Tu enlace de autenticaci√≥n para HashRand",
        Some("ca") => "El teu enlla√ß d'autenticaci√≥ per a HashRand",
        Some("eu") => "Zure HashRand autentifikazio esteka",
        Some("gl") => "A t√∫a ligaz√≥n de autenticaci√≥n para HashRand",
        Some("fr") => "Votre lien d'authentification HashRand",
        Some("de") => "Ihr HashRand-Authentifizierungslink",
        Some("pt") => "Seu link de autentica√ß√£o HashRand",
        Some("ru") => "–í–∞—à–∞ —Å—Å—ã–ª–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ HashRand",
        Some("zh") => "ÊÇ®ÁöÑ HashRand Ë∫´‰ªΩÈ™åËØÅÈìæÊé•",
        Some("ja") => "HashRandË™çË®º„É™„É≥„ÇØ",
        Some("ar") => "ÿ±ÿßÿ®ÿ∑ ŸÖÿµÿßÿØŸÇÿ© HashRand ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ",
        Some("hi") => "‡§Ü‡§™‡§ï‡§æ HashRand ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡§∞‡§£ ‡§≤‡§ø‡§Ç‡§ï",
        _ => "Your HashRand Authentication Link", // Default to English
    }
}

/// Creates the HTML version of the magic link email
fn create_magic_link_html(magic_link: &str, language: Option<&str>) -> String {
    match language {
        Some("es") => create_spanish_html(magic_link),
        Some("ca") => create_catalan_html(magic_link),
        Some("eu") => create_basque_html(magic_link),
        Some("gl") => create_galician_html(magic_link),
        Some("fr") => create_french_html(magic_link),
        Some("de") => create_german_html(magic_link),
        Some("pt") => create_portuguese_html(magic_link),
        Some("ru") => create_russian_html(magic_link),
        Some("zh") => create_chinese_html(magic_link),
        Some("ja") => create_japanese_html(magic_link),
        Some("ar") => create_arabic_html(magic_link),
        Some("hi") => create_hindi_html(magic_link),
        _ => create_english_html(magic_link),
    }
}

/// Creates the English HTML email template
fn create_english_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRand Authentication</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRand Authentication</h1>
        </div>
        <div class="content">
            <h2>Your Magic Link is Ready</h2>
            <p>Click the button below to securely authenticate with HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Access HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Security Notice:</strong>
                <ul>
                    <li>This link is valid for a limited time</li>
                    <li>It can only be used once</li>
                    <li>Do not share this link with anyone</li>
                    <li>If you didn't request this, you can safely ignore this email</li>
                </ul>
            </div>
            
            <p>If the button doesn't work, you can copy and paste this link into your browser:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Zero Knowledge Random Hash Generator</p>
            <p>This is an automated message. Please do not reply to this email.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Spanish HTML email template
fn create_spanish_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Autenticaci√≥n HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Autenticaci√≥n HashRand</h1>
        </div>
        <div class="content">
            <h2>Tu Enlace M√°gico est√° Listo</h2>
            <p>Haz clic en el bot√≥n de abajo para autenticarte de forma segura con HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Acceder a HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Aviso de Seguridad:</strong>
                <ul>
                    <li>Este enlace es v√°lido por tiempo limitado</li>
                    <li>Solo puede usarse una vez</li>
                    <li>No compartas este enlace con nadie</li>
                    <li>Si no solicitaste esto, puedes ignorar este email</li>
                </ul>
            </div>
            
            <p>Si el bot√≥n no funciona, puedes copiar y pegar este enlace en tu navegador:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Generador de Hashes Aleatorios con Zero Knowledge</p>
            <p>Este es un mensaje autom√°tico. Por favor no respondas a este email.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the plain text version of the magic link email
fn create_magic_link_text(magic_link: &str, language: Option<&str>) -> String {
    match language {
        Some("es") => create_spanish_text(magic_link),
        Some("ca") => create_catalan_text(magic_link),
        Some("eu") => create_basque_text(magic_link),
        Some("gl") => create_galician_text(magic_link),
        Some("fr") => create_french_text(magic_link),
        Some("de") => create_german_text(magic_link),
        Some("pt") => create_portuguese_text(magic_link),
        Some("ru") => create_russian_text(magic_link),
        Some("zh") => create_chinese_text(magic_link),
        Some("ja") => create_japanese_text(magic_link),
        Some("ar") => create_arabic_text(magic_link),
        Some("hi") => create_hindi_text(magic_link),
        _ => create_english_text(magic_link),
    }
}

/// Creates the English plain text email
fn create_english_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRAND AUTHENTICATION
=======================

Your Magic Link is Ready!

Click or copy the following link to securely authenticate with HashRand:

{}

SECURITY NOTICE:
- This link is valid for a limited time
- It can only be used once
- Do not share this link with anyone
- If you didn't request this, you can safely ignore this email

---
HashRand - Zero Knowledge Random Hash Generator
This is an automated message. Please do not reply to this email.
"#,
        magic_link
    )
}

/// Creates the Spanish plain text email
fn create_spanish_text(magic_link: &str) -> String {
    format!(
        r#"
AUTENTICACI√ìN HASHRAND
======================

¬°Tu Enlace M√°gico est√° Listo!

Haz clic o copia el siguiente enlace para autenticarte de forma segura con HashRand:

{}

AVISO DE SEGURIDAD:
- Este enlace es v√°lido por tiempo limitado
- Solo puede usarse una vez
- No compartas este enlace con nadie
- Si no solicitaste esto, puedes ignorar este email

---
HashRand - Generador de Hashes Aleatorios con Zero Knowledge
Este es un mensaje autom√°tico. Por favor no respondas a este email.
"#,
        magic_link
    )
}

/// Creates the French HTML email template
fn create_french_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Authentification HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Authentification HashRand</h1>
        </div>
        <div class="content">
            <h2>Votre Lien Magique est Pr√™t</h2>
            <p>Cliquez sur le bouton ci-dessous pour vous authentifier en toute s√©curit√© avec HashRand :</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Acc√©der √† HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Avis de S√©curit√© :</strong>
                <ul>
                    <li>Ce lien est valide pour une dur√©e limit√©e</li>
                    <li>Il ne peut √™tre utilis√© qu'une seule fois</li>
                    <li>Ne partagez pas ce lien avec qui que ce soit</li>
                    <li>Si vous n'avez pas demand√© ceci, vous pouvez ignorer cet email</li>
                </ul>
            </div>
            
            <p>Si le bouton ne fonctionne pas, vous pouvez copier et coller ce lien dans votre navigateur :</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - G√©n√©rateur de Hachages Al√©atoires Zero Knowledge</p>
            <p>Ceci est un message automatique. Veuillez ne pas r√©pondre √† cet email.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the French plain text email
fn create_french_text(magic_link: &str) -> String {
    format!(
        r#"
AUTHENTIFICATION HASHRAND
=========================

Votre Lien Magique est Pr√™t !

Cliquez ou copiez le lien suivant pour vous authentifier en toute s√©curit√© avec HashRand :

{}

AVIS DE S√âCURIT√â :
- Ce lien est valide pour une dur√©e limit√©e
- Il ne peut √™tre utilis√© qu'une seule fois
- Ne partagez pas ce lien avec qui que ce soit
- Si vous n'avez pas demand√© ceci, vous pouvez ignorer cet email

---
HashRand - G√©n√©rateur de Hachages Al√©atoires Zero Knowledge
Ceci est un message automatique. Veuillez ne pas r√©pondre √† cet email.
"#,
        magic_link
    )
}

/// Creates the German HTML email template  
fn create_german_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRand Authentifizierung</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRand Authentifizierung</h1>
        </div>
        <div class="content">
            <h2>Ihr Magic Link ist Bereit</h2>
            <p>Klicken Sie auf die Schaltfl√§che unten, um sich sicher bei HashRand zu authentifizieren:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Zu HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Sicherheitshinweis:</strong>
                <ul>
                    <li>Dieser Link ist nur f√ºr begrenzte Zeit g√ºltig</li>
                    <li>Er kann nur einmal verwendet werden</li>
                    <li>Teilen Sie diesen Link nicht mit anderen</li>
                    <li>Falls Sie dies nicht angefordert haben, k√∂nnen Sie diese E-Mail ignorieren</li>
                </ul>
            </div>
            
            <p>Falls die Schaltfl√§che nicht funktioniert, k√∂nnen Sie diesen Link kopieren und in Ihren Browser einf√ºgen:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Zero Knowledge Zufalls-Hash-Generator</p>
            <p>Dies ist eine automatische Nachricht. Bitte antworten Sie nicht auf diese E-Mail.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the German plain text email
fn create_german_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRAND AUTHENTIFIZIERUNG
===========================

Ihr Magic Link ist Bereit!

Klicken Sie oder kopieren Sie den folgenden Link, um sich sicher bei HashRand zu authentifizieren:

{}

SICHERHEITSHINWEIS:
- Dieser Link ist nur f√ºr begrenzte Zeit g√ºltig
- Er kann nur einmal verwendet werden
- Teilen Sie diesen Link nicht mit anderen
- Falls Sie dies nicht angefordert haben, k√∂nnen Sie diese E-Mail ignorieren

---
HashRand - Zero Knowledge Zufalls-Hash-Generator
Dies ist eine automatische Nachricht. Bitte antworten Sie nicht auf diese E-Mail.
"#,
        magic_link
    )
}

/// Creates the Portuguese HTML email template
fn create_portuguese_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Autentica√ß√£o HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Autentica√ß√£o HashRand</h1>
        </div>
        <div class="content">
            <h2>Seu Link M√°gico est√° Pronto</h2>
            <p>Clique no bot√£o abaixo para se autenticar com seguran√ßa no HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Acessar HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Aviso de Seguran√ßa:</strong>
                <ul>
                    <li>Este link √© v√°lido por tempo limitado</li>
                    <li>S√≥ pode ser usado uma vez</li>
                    <li>N√£o compartilhe este link com ningu√©m</li>
                    <li>Se voc√™ n√£o solicitou isso, pode ignorar este email</li>
                </ul>
            </div>
            
            <p>Se o bot√£o n√£o funcionar, voc√™ pode copiar e colar este link no seu navegador:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Gerador de Hashes Aleat√≥rios Zero Knowledge</p>
            <p>Esta √© uma mensagem autom√°tica. Por favor n√£o responda a este email.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Portuguese plain text email
fn create_portuguese_text(magic_link: &str) -> String {
    format!(
        r#"
AUTENTICA√á√ÉO HASHRAND
=====================

Seu Link M√°gico est√° Pronto!

Clique ou copie o seguinte link para se autenticar com seguran√ßa no HashRand:

{}

AVISO DE SEGURAN√áA:
- Este link √© v√°lido por tempo limitado
- S√≥ pode ser usado uma vez
- N√£o compartilhe este link com ningu√©m
- Se voc√™ n√£o solicitou isso, pode ignorar este email

---
HashRand - Gerador de Hashes Aleat√≥rios Zero Knowledge
Esta √© uma mensagem autom√°tica. Por favor n√£o responda a este email.
"#,
        magic_link
    )
}

/// Creates the Russian HTML email template
fn create_russian_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è HashRand</h1>
        </div>
        <div class="content">
            <h2>–í–∞—à–∞ –ú–∞–≥–∏—á–µ—Å–∫–∞—è –°—Å—ã–ª–∫–∞ –ì–æ—Ç–æ–≤–∞</h2>
            <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ –í–æ–π—Ç–∏ –≤ HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</strong>
                <ul>
                    <li>–≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è</li>
                    <li>–ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑</li>
                    <li>–ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π –Ω–∏ —Å –∫–µ–º</li>
                    <li>–ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —ç—Ç–æ, –º–æ–∂–µ—Ç–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–∏—Å—å–º–æ</li>
                </ul>
            </div>
            
            <p>–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –≤—ã –º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—Å—Ç–∞–≤–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –≤–∞—à –±—Ä–∞—É–∑–µ—Ä:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –°–ª—É—á–∞–π–Ω—ã—Ö –•–µ—à–µ–π —Å –ù—É–ª–µ–≤—ã–º –†–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ–º</p>
            <p>–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —ç—Ç–æ –ø–∏—Å—å–º–æ.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Russian plain text email
fn create_russian_text(magic_link: &str) -> String {
    format!(
        r#"
–ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø HASHRAND
=======================

–í–∞—à–∞ –ú–∞–≥–∏—á–µ—Å–∫–∞—è –°—Å—ã–ª–∫–∞ –ì–æ—Ç–æ–≤–∞!

–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â—É—é —Å—Å—ã–ª–∫—É –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ HashRand:

{}

–£–í–ï–î–û–ú–õ–ï–ù–ò–ï –û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:
- –≠—Ç–∞ —Å—Å—ã–ª–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
- –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–æ–π —Å—Å—ã–ª–∫–æ–π –Ω–∏ —Å –∫–µ–º
- –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏ —ç—Ç–æ, –º–æ–∂–µ—Ç–µ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –ø–∏—Å—å–º–æ

---
HashRand - –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –°–ª—É—á–∞–π–Ω—ã—Ö –•–µ—à–µ–π —Å –ù—É–ª–µ–≤—ã–º –†–∞–∑–≥–ª–∞—à–µ–Ω–∏–µ–º
–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –æ—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ —ç—Ç–æ –ø–∏—Å—å–º–æ.
"#,
        magic_link
    )
}

/// Creates the Chinese HTML email template
fn create_chinese_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRand Ë∫´‰ªΩÈ™åËØÅ</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRand Ë∫´‰ªΩÈ™åËØÅ</h1>
        </div>
        <div class="content">
            <h2>ÊÇ®ÁöÑÈ≠îÊ≥ïÈìæÊé•Â∑≤ÂáÜÂ§áÂ∞±Áª™</h2>
            <p>ÁÇπÂáª‰∏ãÊñπÊåâÈíÆÂÆâÂÖ®Âú∞ÁôªÂΩï HashRandÔºö</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ ËÆøÈóÆ HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>ÂÆâÂÖ®ÊèêÁ§∫Ôºö</strong>
                <ul>
                    <li>Ê≠§ÈìæÊé•ÊúâÊïàÊúüÊúâÈôê</li>
                    <li>Âè™ËÉΩ‰ΩøÁî®‰∏ÄÊ¨°</li>
                    <li>ËØ∑Âãø‰∏é‰ªñ‰∫∫ÂàÜ‰∫´Ê≠§ÈìæÊé•</li>
                    <li>Â¶ÇÊûúÊÇ®Ê≤°ÊúâËØ∑Ê±ÇÊ≠§Êìç‰ΩúÔºåÂèØ‰ª•ÂøΩÁï•Ê≠§ÈÇÆ‰ª∂</li>
                </ul>
            </div>
            
            <p>Â¶ÇÊûúÊåâÈíÆ‰∏çËµ∑‰ΩúÁî®ÔºåÊÇ®ÂèØ‰ª•Â§çÂà∂Âπ∂Á≤òË¥¥Ê≠§ÈìæÊé•Âà∞ÊÇ®ÁöÑÊµèËßàÂô®Ôºö</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Èõ∂Áü•ËØÜÈöèÊú∫ÂìàÂ∏åÁîüÊàêÂô®</p>
            <p>ËøôÊòØ‰∏ÄÂ∞ÅËá™Âä®ÈÇÆ‰ª∂„ÄÇËØ∑‰∏çË¶ÅÂõûÂ§çÊ≠§ÈÇÆ‰ª∂„ÄÇ</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Chinese plain text email
fn create_chinese_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRAND Ë∫´‰ªΩÈ™åËØÅ
=================

ÊÇ®ÁöÑÈ≠îÊ≥ïÈìæÊé•Â∑≤ÂáÜÂ§áÂ∞±Áª™ÔºÅ

ÁÇπÂáªÊàñÂ§çÂà∂‰ª•‰∏ãÈìæÊé•ÂÆâÂÖ®Âú∞ÁôªÂΩï HashRandÔºö

{}

ÂÆâÂÖ®ÊèêÁ§∫Ôºö
- Ê≠§ÈìæÊé•ÊúâÊïàÊúüÊúâÈôê
- Âè™ËÉΩ‰ΩøÁî®‰∏ÄÊ¨°
- ËØ∑Âãø‰∏é‰ªñ‰∫∫ÂàÜ‰∫´Ê≠§ÈìæÊé•
- Â¶ÇÊûúÊÇ®Ê≤°ÊúâËØ∑Ê±ÇÊ≠§Êìç‰ΩúÔºåÂèØ‰ª•ÂøΩÁï•Ê≠§ÈÇÆ‰ª∂

---
HashRand - Èõ∂Áü•ËØÜÈöèÊú∫ÂìàÂ∏åÁîüÊàêÂô®
ËøôÊòØ‰∏ÄÂ∞ÅËá™Âä®ÈÇÆ‰ª∂„ÄÇËØ∑‰∏çË¶ÅÂõûÂ§çÊ≠§ÈÇÆ‰ª∂„ÄÇ
"#,
        magic_link
    )
}

/// Creates the Japanese HTML email template
fn create_japanese_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRandË™çË®º</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRandË™çË®º</h1>
        </div>
        <div class="content">
            <h2>„Éû„Ç∏„ÉÉ„ÇØ„É™„É≥„ÇØ„ÅÆÊ∫ñÂÇô„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü</h2>
            <p>‰∏ã„ÅÆ„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÄÅHashRand„Å´ÂÆâÂÖ®„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ HashRand„Å´„Ç¢„ÇØ„Çª„Çπ</a>
            </div>
            
            <div class="security-notice">
                <strong>„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å´„Å§„ÅÑ„Å¶Ôºö</strong>
                <ul>
                    <li>„Åì„ÅÆ„É™„É≥„ÇØ„ÅØÊúâÂäπÊúüÈôê„Åå„ÅÇ„Çä„Åæ„Åô</li>
                    <li>‰∏ÄÂ∫¶„Å†„Åë‰ΩøÁî®„Åß„Åç„Åæ„Åô</li>
                    <li>„Åì„ÅÆ„É™„É≥„ÇØ„Çí‰ªñ„ÅÆ‰∫∫„Å®ÂÖ±Êúâ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ</li>
                    <li>„Åì„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„Åì„ÅÆ„É°„Éº„É´„ÇíÁÑ°Ë¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</li>
                </ul>
            </div>
            
            <p>„Éú„Çø„É≥„ÅåÊ©üËÉΩ„Åó„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„Åì„ÅÆ„É™„É≥„ÇØ„Çí„Ç≥„Éî„Éº„Åó„Å¶„Éñ„É©„Ç¶„Ç∂„Å´Ë≤º„Çä‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºö</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - „Çº„É≠Áü•Ë≠ò„É©„É≥„ÉÄ„É†„Éè„ÉÉ„Ç∑„É•„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº</p>
            <p>„Åì„Çå„ÅØËá™ÂãïÈÄÅ‰ø°„É°„Éº„É´„Åß„Åô„ÄÇ„Åì„ÅÆ„É°„Éº„É´„Å´„ÅØËøî‰ø°„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Japanese plain text email
fn create_japanese_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRANDË™çË®º
============

„Éû„Ç∏„ÉÉ„ÇØ„É™„É≥„ÇØ„ÅÆÊ∫ñÂÇô„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ

‰ª•‰∏ã„ÅÆ„É™„É≥„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åæ„Åü„ÅØ„Ç≥„Éî„Éº„Åó„Å¶„ÄÅHashRand„Å´ÂÆâÂÖ®„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö

{}

„Çª„Ç≠„É•„É™„ÉÜ„Ç£„Å´„Å§„ÅÑ„Å¶Ôºö
- „Åì„ÅÆ„É™„É≥„ÇØ„ÅØÊúâÂäπÊúüÈôê„Åå„ÅÇ„Çä„Åæ„Åô
- ‰∏ÄÂ∫¶„Å†„Åë‰ΩøÁî®„Åß„Åç„Åæ„Åô
- „Åì„ÅÆ„É™„É≥„ÇØ„Çí‰ªñ„ÅÆ‰∫∫„Å®ÂÖ±Êúâ„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ
- „Åì„ÅÆ„É™„ÇØ„Ç®„Çπ„Éà„Çí„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„ÄÅ„Åì„ÅÆ„É°„Éº„É´„ÇíÁÑ°Ë¶ñ„Åó„Å¶„Åè„Å†„Åï„ÅÑ

---
HashRand - „Çº„É≠Áü•Ë≠ò„É©„É≥„ÉÄ„É†„Éè„ÉÉ„Ç∑„É•„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº
„Åì„Çå„ÅØËá™ÂãïÈÄÅ‰ø°„É°„Éº„É´„Åß„Åô„ÄÇ„Åì„ÅÆ„É°„Éº„É´„Å´„ÅØËøî‰ø°„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ
"#,
        magic_link
    )
}

/// Creates the Arabic HTML email template
fn create_arabic_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="utf-8">
    <title>ŸÖÿµÿßÿØŸÇÿ© HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; direction: rtl; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê ŸÖÿµÿßÿØŸÇÿ© HashRand</h1>
        </div>
        <div class="content">
            <h2>ÿ±ÿßÿ®ÿ∑ŸÉ ÿßŸÑÿ≥ÿ≠ÿ±Ÿä ÿ¨ÿßŸáÿ≤</h2>
            <p>ÿßŸÜŸÇÿ± ÿπŸÑŸâ ÿßŸÑÿ≤ÿ± ÿ£ÿØŸÜÿßŸá ŸÑŸÑŸÖÿµÿßÿØŸÇÿ© ÿ®ÿ£ŸÖÿßŸÜ ŸÖÿπ HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>ÿ™ŸÜÿ®ŸäŸá ÿ£ŸÖŸÜŸä:</strong>
                <ul>
                    <li>Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿµÿßŸÑÿ≠ ŸÑŸàŸÇÿ™ ŸÖÿ≠ÿØŸàÿØ</li>
                    <li>ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑</li>
                    <li>ŸÑÿß ÿ™ÿ¥ÿßÿ±ŸÉ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÖÿπ ÿ£Ÿä ÿ¥ÿÆÿµ</li>
                    <li>ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ∑ŸÑÿ® Ÿáÿ∞ÿßÿå ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ¨ÿßŸáŸÑ Ÿáÿ∞ÿß ÿßŸÑÿ•ŸäŸÖŸäŸÑ</li>
                </ul>
            </div>
            
            <p>ÿ•ÿ∞ÿß ŸÑŸÖ ŸäÿπŸÖŸÑ ÿßŸÑÿ≤ÿ±ÿå ŸäŸÖŸÉŸÜŸÉ ŸÜÿ≥ÿÆ ŸàŸÑÿµŸÇ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÅŸä ŸÖÿ™ÿµŸÅÿ≠ŸÉ:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace; direction: ltr;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - ŸÖŸàŸÑÿØ ÿßŸÑŸáÿßÿ¥ ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ®ÿßŸÑŸÖÿπÿ±ŸÅÿ© ÿßŸÑÿµŸÅÿ±Ÿäÿ©</p>
            <p>Ÿáÿ∞Ÿá ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿπÿØŸÖ ÿßŸÑÿ±ÿØ ÿπŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑÿ•ŸäŸÖŸäŸÑ.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Arabic plain text email
fn create_arabic_text(magic_link: &str) -> String {
    format!(
        r#"
ŸÖÿµÿßÿØŸÇÿ© HASHRAND
================

ÿ±ÿßÿ®ÿ∑ŸÉ ÿßŸÑÿ≥ÿ≠ÿ±Ÿä ÿ¨ÿßŸáÿ≤!

ÿßŸÜŸÇÿ± ÿ£Ÿà ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ™ÿßŸÑŸä ŸÑŸÑŸÖÿµÿßÿØŸÇÿ© ÿ®ÿ£ŸÖÿßŸÜ ŸÖÿπ HashRand:

{}

ÿ™ŸÜÿ®ŸäŸá ÿ£ŸÖŸÜŸä:
- Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ÿµÿßŸÑÿ≠ ŸÑŸàŸÇÿ™ ŸÖÿ≠ÿØŸàÿØ
- ŸäŸÖŸÉŸÜ ÿßÿ≥ÿ™ÿÆÿØÿßŸÖŸá ŸÖÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸÇÿ∑
- ŸÑÿß ÿ™ÿ¥ÿßÿ±ŸÉ Ÿáÿ∞ÿß ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÖÿπ ÿ£Ÿä ÿ¥ÿÆÿµ
- ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ÿ∑ŸÑÿ® Ÿáÿ∞ÿßÿå ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ¨ÿßŸáŸÑ Ÿáÿ∞ÿß ÿßŸÑÿ•ŸäŸÖŸäŸÑ

---
HashRand - ŸÖŸàŸÑÿØ ÿßŸÑŸáÿßÿ¥ ÿßŸÑÿπÿ¥Ÿàÿßÿ¶Ÿä ÿ®ÿßŸÑŸÖÿπÿ±ŸÅÿ© ÿßŸÑÿµŸÅÿ±Ÿäÿ©
Ÿáÿ∞Ÿá ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸÑŸÇÿßÿ¶Ÿäÿ©. Ÿäÿ±ÿ¨Ÿâ ÿπÿØŸÖ ÿßŸÑÿ±ÿØ ÿπŸÑŸâ Ÿáÿ∞ÿß ÿßŸÑÿ•ŸäŸÖŸäŸÑ.
"#,
        magic_link
    )
}

/// Creates the Hindi HTML email template
fn create_hindi_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRand ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡§∞‡§£</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRand ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡§∞‡§£</h1>
        </div>
        <div class="content">
            <h2>‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•à‡§ú‡§ø‡§ï ‡§≤‡§ø‡§Ç‡§ï ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à</h2>
            <p>HashRand ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡•Ä‡§ö‡•á ‡§¶‡§ø‡§è ‡§ó‡§è ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ HashRand ‡§§‡§ï ‡§™‡§π‡•Å‡§Ç‡§ö‡•á‡§Ç</a>
            </div>
            
            <div class="security-notice">
                <strong>‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ:</strong>
                <ul>
                    <li>‡§Ø‡§π ‡§≤‡§ø‡§Ç‡§ï ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•à‡§ß ‡§π‡•à</li>
                    <li>‡§á‡§∏‡§ï‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§π‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à</li>
                    <li>‡§á‡§∏ ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç</li>
                    <li>‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§®‡•á ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§á‡§∏ ‡§à‡§Æ‡•á‡§≤ ‡§ï‡•ã ‡§®‡§ú‡§º‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§º ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</li>
                </ul>
            </div>
            
            <p>‡§Ø‡§¶‡§ø ‡§¨‡§ü‡§® ‡§ï‡§æ‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§á‡§∏ ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ã ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•á ‡§¨‡•ç‡§∞‡§æ‡§â‡§ú‡§º‡§∞ ‡§Æ‡•á‡§Ç ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§π‡•à‡§∂ ‡§ú‡§®‡§∞‡•á‡§ü‡§∞</p>
            <p>‡§Ø‡§π ‡§è‡§ï ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏ ‡§à‡§Æ‡•á‡§≤ ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§® ‡§¶‡•á‡§Ç‡•§</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the Hindi plain text email
fn create_hindi_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRAND ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡•Ä‡§ï‡§∞‡§£
====================

‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•à‡§ú‡§ø‡§ï ‡§≤‡§ø‡§Ç‡§ï ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à!

HashRand ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§ø‡§Æ‡•ç‡§®‡§≤‡§ø‡§ñ‡§ø‡§§ ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§ï‡•â‡§™‡•Ä ‡§ï‡§∞‡•á‡§Ç:

{}

‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡•Ç‡§ö‡§®‡§æ:
- ‡§Ø‡§π ‡§≤‡§ø‡§Ç‡§ï ‡§∏‡•Ä‡§Æ‡§ø‡§§ ‡§∏‡§Æ‡§Ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡•à‡§ß ‡§π‡•à
- ‡§á‡§∏‡§ï‡§æ ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§π‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à
- ‡§á‡§∏ ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ã ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç
- ‡§Ø‡§¶‡§ø ‡§Ü‡§™‡§®‡•á ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§™ ‡§á‡§∏ ‡§à‡§Æ‡•á‡§≤ ‡§ï‡•ã ‡§®‡§ú‡§º‡§∞‡§Ö‡§Ç‡§¶‡§æ‡§ú‡§º ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç

---
HashRand - ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§ú‡•ç‡§û‡§æ‡§® ‡§∞‡•à‡§Ç‡§°‡§Æ ‡§π‡•à‡§∂ ‡§ú‡§®‡§∞‡•á‡§ü‡§∞
‡§Ø‡§π ‡§è‡§ï ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏ ‡§à‡§Æ‡•á‡§≤ ‡§ï‡§æ ‡§â‡§§‡•ç‡§§‡§∞ ‡§® ‡§¶‡•á‡§Ç‡•§
"#,
        magic_link
    )
}

// Functions for Catalan, Basque, and Galician (Peninsula languages)
/// Creates the Catalan HTML email template
fn create_catalan_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Autenticaci√≥ HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Autenticaci√≥ HashRand</h1>
        </div>
        <div class="content">
            <h2>El teu Enlla√ß M√†gic est√† Llest</h2>
            <p>Fes clic al bot√≥ seg√ºent per autenticar-te de forma segura amb HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Accedir a HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Av√≠s de Seguretat:</strong>
                <ul>
                    <li>Aquest enlla√ß √©s v√†lid per temps limitat</li>
                    <li>Nom√©s es pot fer servir una vegada</li>
                    <li>No comparteixis aquest enlla√ß amb ning√∫</li>
                    <li>Si no has demanat aix√≤, pots ignorar aquest correu</li>
                </ul>
            </div>
            
            <p>Si el bot√≥ no funciona, pots copiar i enganxar aquest enlla√ß al teu navegador:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Generador d'Hashes Aleatoris amb Zero Knowledge</p>
            <p>Aquest √©s un missatge autom√†tic. Si us plau no responguis a aquest correu.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

/// Creates the remaining text functions for Peninsula languages
fn create_catalan_text(magic_link: &str) -> String {
    format!(
        r#"
AUTENTICACI√ì HASHRAND
=====================

El teu Enlla√ß M√†gic est√† Llest!

Fes clic o copia l'enlla√ß seg√ºent per autenticar-te de forma segura amb HashRand:

{}

AV√çS DE SEGURETAT:
- Aquest enlla√ß √©s v√†lid per temps limitat
- Nom√©s es pot fer servir una vegada
- No comparteixis aquest enlla√ß amb ning√∫
- Si no has demanat aix√≤, pots ignorar aquest correu

---
HashRand - Generador d'Hashes Aleatoris amb Zero Knowledge
Aquest √©s un missatge autom√†tic. Si us plau no responguis a aquest correu.
"#,
        magic_link
    )
}

fn create_basque_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>HashRand Autentifikazioa</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê HashRand Autentifikazioa</h1>
        </div>
        <div class="content">
            <h2>Zure Esteka Magikoa Prest Dago</h2>
            <p>Egin klik beheko botoian HashRand-ekin modu seguruan autentifikatzeko:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ HashRand-era Sartu</a>
            </div>
            
            <div class="security-notice">
                <strong>Segurtasun Oharra:</strong>
                <ul>
                    <li>Esteka hau denbora mugatuan balio du</li>
                    <li>Behin bakarrik erabili daiteke</li>
                    <li>Ez konpartitu esteka hau inorekin</li>
                    <li>Hau eskatu ez baduzu, mezu hau bazter dezakezu</li>
                </ul>
            </div>
            
            <p>Botoia ez badu funtzionatzen, esteka hau kopia eta itsats dezakezu zure nabigatzailean:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Zero Knowledge Hash Sortzaile Ausazkoa</p>
            <p>Mezu automatiko hau da. Ez erantzun mezu honi.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

fn create_basque_text(magic_link: &str) -> String {
    format!(
        r#"
HASHRAND AUTENTIFIKAZIOA
========================

Zure Esteka Magikoa Prest Dago!

Egin klik edo kopiatu hurrengo esteka HashRand-ekin modu seguruan autentifikatzeko:

{}

SEGURTASUN OHARRA:
- Esteka hau denbora mugatuan balio du
- Behin bakarrik erabili daiteke
- Ez konpartitu esteka hau inorekin
- Hau eskatu ez baduzu, mezu hau bazter dezakezu

---
HashRand - Zero Knowledge Hash Sortzaile Ausazkoa
Mezu automatiko hau da. Ez erantzun mezu honi.
"#,
        magic_link
    )
}

fn create_galician_html(magic_link: &str) -> String {
    format!(
        r#"
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Autenticaci√≥n HashRand</title>
    <style>
        body {{ font-family: Arial, sans-serif; line-height: 1.6; color: #333; }}
        .container {{ max-width: 600px; margin: 0 auto; padding: 20px; }}
        .header {{ background: #2563eb; color: white; padding: 20px; text-align: center; border-radius: 8px 8px 0 0; }}
        .content {{ background: #f9fafb; padding: 30px; border: 1px solid #e5e7eb; }}
        .button {{ display: inline-block; background: #2563eb; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0; }}
        .footer {{ background: #6b7280; color: white; padding: 15px; text-align: center; font-size: 12px; border-radius: 0 0 8px 8px; }}
        .security-notice {{ background: #fef3c7; border: 1px solid #f59e0b; padding: 15px; margin: 20px 0; border-radius: 6px; }}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Autenticaci√≥n HashRand</h1>
        </div>
        <div class="content">
            <h2>A t√∫a Ligaz√≥n M√°xica est√° Lista</h2>
            <p>Preme no bot√≥n de abaixo para autenticarte de xeito seguro con HashRand:</p>
            
            <div style="text-align: center;">
                <a href="{}" class="button">üöÄ Acceder a HashRand</a>
            </div>
            
            <div class="security-notice">
                <strong>Aviso de Seguridade:</strong>
                <ul>
                    <li>Esta ligaz√≥n √© v√°lida por tempo limitado</li>
                    <li>S√≥ se pode usar unha vez</li>
                    <li>Non compartas esta ligaz√≥n con ningu√©n</li>
                    <li>Se non solicitaches isto, podes ignorar este correo</li>
                </ul>
            </div>
            
            <p>Se o bot√≥n non funciona, podes copiar e pegar esta ligaz√≥n no teu navegador:</p>
            <p style="word-break: break-all; background: #e5e7eb; padding: 10px; border-radius: 4px; font-family: monospace;">
                {}
            </p>
        </div>
        <div class="footer">
            <p>HashRand - Xerador de Hashes Aleatorios con Zero Knowledge</p>
            <p>Esta √© unha mensaxe autom√°tica. Por favor non respondas a este correo.</p>
        </div>
    </div>
</body>
</html>
"#,
        magic_link, magic_link
    )
}

fn create_galician_text(magic_link: &str) -> String {
    format!(
        r#"
AUTENTICACI√ìN HASHRAND
======================

A t√∫a Ligaz√≥n M√°xica est√° Lista!

Preme ou copia a seguinte ligaz√≥n para autenticarte de xeito seguro con HashRand:

{}

AVISO DE SEGURIDADE:
- Esta ligaz√≥n √© v√°lida por tempo limitado
- S√≥ se pode usar unha vez
- Non compartas esta ligaz√≥n con ningu√©n
- Se non solicitaches isto, podes ignorar este correo

---
HashRand - Xerador de Hashes Aleatorios con Zero Knowledge
Esta √© unha mensaxe autom√°tica. Por favor non respondas a este correo.
"#,
        magic_link
    )
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_email_validation() {
        // Test basic email validation logic
        assert!("".is_empty() || !"".contains('@'));
        assert!(!"invalid-email".contains('@'));

        let valid_email = "valid@example.com";
        assert!(valid_email.contains('@') && !valid_email.is_empty());
    }

    #[test]
    fn test_html_content_generation() {
        let magic_link = "https://example.com/magic?token=abc123";

        // Test English HTML
        let html_en = create_magic_link_html(magic_link, None);
        assert!(html_en.contains(magic_link));
        assert!(html_en.contains("HashRand Authentication"));
        assert!(html_en.contains("Security Notice"));

        // Test Spanish HTML
        let html_es = create_magic_link_html(magic_link, Some("es"));
        assert!(html_es.contains(magic_link));
        assert!(html_es.contains("Autenticaci√≥n HashRand"));
        assert!(html_es.contains("Aviso de Seguridad"));
    }

    #[test]
    fn test_text_content_generation() {
        let magic_link = "https://example.com/magic?token=abc123";

        // Test English text
        let text_en = create_magic_link_text(magic_link, None);
        assert!(text_en.contains(magic_link));
        assert!(text_en.contains("HASHRAND AUTHENTICATION"));
        assert!(text_en.contains("SECURITY NOTICE"));

        // Test Spanish text
        let text_es = create_magic_link_text(magic_link, Some("es"));
        assert!(text_es.contains(magic_link));
        assert!(text_es.contains("AUTENTICACI√ìN HASHRAND"));
        assert!(text_es.contains("AVISO DE SEGURIDAD"));
    }

    #[test]
    fn test_subject_generation() {
        // Test English subject
        assert_eq!(create_subject(None), "Your HashRand Authentication Link");
        assert_eq!(
            create_subject(Some("en")),
            "Your HashRand Authentication Link"
        );

        // Test Spanish subject
        assert_eq!(
            create_subject(Some("es")),
            "Tu enlace de autenticaci√≥n para HashRand"
        );
    }

    #[test]
    fn test_email_payload_structure() {
        let config = EmailConfig {
            api_url: "https://test.api".to_string(),
            api_token: "test_token".to_string(),
            from_email: "test@example.com".to_string(),
        };

        let request = create_email_request(
            &config,
            "recipient@example.com",
            "https://magic.link",
            Some("es"),
        );
        assert!(request.is_ok());

        if let Ok(req) = request {
            assert_eq!(req.method(), &Method::Post);
            // Test that the request was built successfully
            assert!(req.body().len() > 0); // Body should contain JSON
        }
    }
}
